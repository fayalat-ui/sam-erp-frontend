import { sharePointClient } from "../lib/sharepoint";

/**
 * Servicio de alto nivel para consumir listas de SharePoint.
 * Cada funci√≥n apunta a una lista espec√≠fica.
 */

/** =========================
 *  TRABAJADORES (CRUD)
 *  ========================= */

// Lectura lista
export async function getTrabajadores() {
  return sharePointClient.getListItems("TBL_TRABAJADORES");
}

// Lectura por ID
export async function getTrabajadorById(id: string | number) {
  // Usamos getListItems + filter por id si tu cliente no tiene getById dedicado.
  // Pero como ya tienes getTrabajadorById en otro lado, mantenemos compatibilidad:
  // üëâ Si ya lo tienes implementado en otro archivo, puedes borrar este y seguir usando el tuyo.
  const items = await sharePointClient.getListItems("TBL_TRABAJADORES");
  const found = items.find((it: any) => String(it.id) === String(id));
  if (!found) throw new Error("Trabajador no encontrado");
  return found;
}

/**
 * Crear trabajador (m√≠nimo viable, conservador)
 * IMPORTANTE:
 * - SharePoint te exige algunas columnas dependiendo de tu configuraci√≥n.
 * - Aqu√≠ mandamos solo campos seguros. Title lo mandamos por si acaso (muchas listas lo piden).
 */
export async function createTrabajador(fields: {
  // Identidad
  Nombres?: string;
  Apellidos?: string;
  T_documento?: string;
  N_documento?: string;
  NACIMIENTO?: string; // "YYYY-MM-DD" recomendado
  Nacionalidad?: string;
  GENERO?: string;
  Estado_civil?: string;

  // Contacto
  Email_Empresa?: string;
  Email_PERSONAL?: string;
  Celular?: string;
  DIRECCION_ANTIGUA?: string;
  Ciudad?: string;

  // Emergencia
  Contacto_Emergencia?: string;
  Telefono_Emergencia?: string;

  // Laboral
  Estado?: string;
  ROL?: string;
  Profesion?: string;
  Nivel_educativo?: string;
  Inscripcion_militar?: string;

  // Pago
  BANCO_PAGO?: string;
  TIPO_CUENTA_PAGO?: string;
  NUMERO_CUENTA_PAGO?: string;
  TITULAR_CUENTA_PAGO?: string;

  // Otros
  Notas?: string;
}) {
  // Muchos SharePoint list templates traen "Title". En tu lista existe "T√≠tulo".
  // Como t√∫ no lo muestras, lo completamos sin molestar: Nombre + Apellido o RUT.
  const title =
    `${fields.Nombres ?? ""} ${fields.Apellidos ?? ""}`.trim() ||
    fields.N_documento ||
    "Trabajador";

  const payload: Record<string, unknown> = {
    Title: title,
    ...fields,
  };

  return sharePointClient.createListItem("TBL_TRABAJADORES", payload);
}

export async function updateTrabajador(
  id: string | number,
  fields: Record<string, unknown>
) {
  return sharePointClient.updateListItem("TBL_TRABAJADORES", String(id), fields);
}

export async function deleteTrabajador(id: string | number) {
  return sharePointClient.deleteListItem("TBL_TRABAJADORES", String(id));
}

/** =========================
 *  OTRAS LISTAS (LECTURA)
 *  ========================= */

export async function getMandantes() {
  return sharePointClient.getListItems("TBL_MANDANTES");
}

export async function getServicios() {
  return sharePointClient.getListItems("TBL_SERVICIOS");
}

export async function getVacaciones() {
  return sharePointClient.getListItems("TBL_VACACIONES");
}

export async function getDirectivas() {
  return sharePointClient.getListItems("TBL_DIRECTIVAS");
}

export async function getSolicitudesContrato() {
  return sharePointClient.getListItems("SOLICITUD_CONTRATOS");
}

export async function getCursosOS10() {
  return sharePointClient.getListItems("TBL_REGISTRO_CURSO_OS10");
}
